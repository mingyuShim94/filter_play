물론입니다. 프로젝트 구현을 위한 기술 명세 및 가이드라인 문서를 아래와 같이 정리해 드렸습니다. 이 문서를 개발을 담당할 AI나 개발자에게 제공하면 명확한 지침이 될 것입니다.

---

## **프로젝트 기술 명세서: 동적 애셋 로딩을 지원하는 Flutter 게임 필터 앱**

### **1. 프로젝트 개요**

본 프로젝트는 TikTok 스타일의 인터랙티브 게임 필터 애플리케이션을 Flutter로 개발하는 것을 목표로 한다. 사용자의 얼굴, 음성 등과 상호작용하는 게임 콘텐츠를 카메라 화면 위에 오버레이하여 보여주고, 이 과정을 영상으로 녹화 및 저장하는 기능을 포함한다.

핵심 요구사항은 앱 업데이트 없이 새로운 게임 콘텐츠(스테이지, 캐릭터 스킨, 아이템 등)를 지속적으로 추가하고 변경할 수 있는 유연한 구조를 갖추는 것이다.

### **2. 핵심 아키텍처**

**"게임 로직은 Flutter 앱 내부에, 애셋(Asset)은 외부 서버에서 동적으로 로드"**하는 하이브리드 아키텍처를 채택한다.

- **게임 로직 (Flutter App):**

  - 게임의 핵심 규칙, 물리 엔진, 사용자 입력 처리, 캐릭터의 동작(점프, 이동 등)과 관련된 모든 코드는 Flutter 프레임워크(및 Flame 게임 엔진)를 사용하여 Dart 언어로 작성된다.
  - 이 로직은 앱 설치 시점에 포함되어 네이티브 성능을 최대한 보장한다.

- **게임 애셋 (External Server):**

  - 게임에 사용되는 모든 시각적/청각적 요소(이미지, 사운드, 3D 모델, 폰트, 레벨 구성 데이터 등)는 앱 외부에 저장된다.
  - 앱은 시작 시 또는 필요할 때 이 애셋들을 네트워크를 통해 다운로드하여 게임 로직에 적용한다.

- **기대 효과:**
  - **네이티브 성능:** 핵심 로직이 네이티브로 실행되어 부드러운 사용자 경험을 제공한다.
  - **콘텐츠 유연성:** 서버의 애셋 파일만 교체하거나 추가함으로써 새로운 스테이지, 이벤트, 아이템을 배포할 수 있다. 이는 트렌드에 빠르게 대응하는 데 필수적이다.
  - **관리 용이성:** 콘텐츠 업데이트를 위해 앱 스토어 심사를 다시 받을 필요가 없어 배포 과정이 매우 신속하다.

### **3. 애셋 저장 및 전송 기술 스택**

애셋의 저장, 관리, 전송을 위해 **Cloudflare R2**를 주력 기술로 사용한다.

- **선정 사유:**
  - **다운로드 트래픽 비용 없음 (Zero Egress Fees):** 사용자가 애셋을 아무리 많이 다운로드해도 데이터 전송 비용이 발생하지 않는다. 이는 게임 애셋처럼 다운로드가 빈번한 서비스에서 총비용을 획기적으로 절감시킨다.
  - **저렴한 저장 비용:** 월 10GB의 무료 저장 공간을 제공하며, 초과분 역시 타 서비스 대비 저렴하다.
  - **고성능 CDN 기본 통합:** Cloudflare의 강력한 글로벌 CDN 네트워크가 기본으로 통합되어 있어, 전 세계 사용자에게 빠르고 안정적인 애셋 다운로드 속도를 제공한다.
  - **간편한 관리:** AWS S3 등과 비교하여 초기 설정이 간단하고 직관적이다.

### **4. 구현 상세 가이드**

#### **4.1. Cloudflare R2 애셋 관리 워크플로**

1.  **R2 버킷 생성:** Cloudflare 대시보드에서 R2 버킷을 생성하고, 공개적으로 접근 가능하도록 설정한다.
2.  **애셋 구조화:** 게임별, 버전별로 폴더를 나누어 애셋(예: `cow_jump_v1/cow.png`, `cow_jump_v1/jump.mp3`)을 체계적으로 관리한다.
3.  **매니페스트 파일(manifest.json) 생성:**
    - 각 게임 콘텐츠의 구성 정보를 담은 `manifest.json` 파일을 작성한다. 이 파일은 해당 게임을 구성하는 데 필요한 모든 애셋의 목록과 메타데이터를 담는 '설계도' 역할을 한다.
    - **`manifest.json` 예시:**
      ```json
      {
        "gameId": "cow_jump",
        "version": "1.0.1",
        "gameTitle": "음메음메 점프",
        "assets": [
          {
            "type": "image",
            "key": "character",
            "url": "https://[your-r2-bucket-url]/cow_jump_v1/cow_sprite.png"
          },
          {
            "type": "image",
            "key": "obstacle",
            "url": "https://[your-r2-bucket-url]/cow_jump_v1/fence.png"
          },
          {
            "type": "sound",
            "key": "jump_effect",
            "url": "https://[your-r2-bucket-url]/cow_jump_v1/jump.mp3"
          },
          {
            "type": "json",
            "key": "level_config",
            "url": "https://[your-r2-bucket-url]/cow_jump_v1/level_1.json"
          }
        ]
      }
      ```
4.  **업로드:** 준비된 애셋 파일들과 `manifest.json` 파일을 R2 버킷의 해당 경로에 업로드한다.

#### **4.2. Flutter 앱 구현 워크플로**

1.  **필요 패키지 설치:**

    - `http` 또는 `dio`: 네트워크 통신 (매니페스트 파일 로드)
    - `cached_network_image`: 이미지 다운로드 및 자동 캐싱
    - `path_provider`: 사운드 등 기타 파일 저장을 위한 기기 내 경로 확보
    - `flame` / `flame_forge2d`: 게임 로직 및 물리 엔진 구현

2.  **애셋 로딩 및 캐싱 로직 구현:**

    - **a. 매니페스트 로드:** 앱 시작 시 또는 게임 선택 시, 서버의 `manifest.json` 파일을 `http`로 불러온다.
    - **b. JSON 파싱:** 불러온 JSON 데이터를 Dart 모델 클래스(예: `GameManifest`, `AssetItem`)로 파싱한다.
    - **c. 애셋 다운로드 및 캐싱:**
      - **이미지:** `manifest.json`에 명시된 이미지 URL들을 `cached_network_image` 위젯에 전달하여 화면에 표시한다. 이 패키지가 자동으로 다운로드와 캐시를 관리한다.
      - **사운드 및 기타 파일:** URL을 통해 파일을 다운로드하고, `path_provider`로 얻은 앱 내부 디렉터리에 저장한다. 파일이 이미 존재하는지 확인하여 불필요한 재다운로드를 방지한다.

3.  **게임 로직과 애셋 연결:**

    - Flutter/Flame으로 작성된 게임 로직(예: `CowCharacter` 클래스)은 네트워크 URL이 아닌, **기기에 캐싱된 파일의 경로(path)**를 참조하여 애셋(이미지, 사운드 등)을 로드한다.
    - 이를 통해 한번 로드된 애셋은 오프라인 상태에서도 사용할 수 있으며, 로딩 속도가 비약적으로 향상된다.

4.  **콘텐츠 업데이트 처리:**
    - 새로운 콘텐츠를 배포할 때는 R2 서버의 애셋과 `manifest.json` 파일만 업데이트하면 된다.
    - 앱은 시작 시 `manifest.json`의 `version` 정보를 로컬에 저장된 버전과 비교하여, 새로운 버전이 감지되면 새로운 애셋을 다운로드하도록 유도할 수 있다.

---

위 명세서는 본 프로젝트의 기술적 방향과 핵심 구현 전략을 정의합니다. 이 가이드라인에 따라 개발을 진행해 주시기 바랍니다.
