# 얼굴 인식 미니게임 앱 개발 계획

## 📋 개발 전략

- **총 26개 세부 태스크**로 구성
- **google_mlkit_face_detection 부분을 8개 태스크로 세분화**
- **각 태스크 완료 시마다 사용자 확인 요청**
- 독립적 검증 가능한 단위로 분할

## 🏗️ Phase 1: 프로젝트 기반 설정 (1일)

### ✅ T1.1: Flutter 프로젝트 초기 설정 [완료]

- **목표**: pubspec.yaml에 모든 의존성 추가
- **완료 기준**: 빌드 성공, 의존성 충돌 없음
- **검증 결과**: ✅ 정적 분석 통과, 의존성 설치 완료
- **소요 시간**: 30분

### ✅ T1.2: 기본 앱 구조 설정 [완료]

- **목표**: Riverpod 상태관리, 라우팅 설정
- **구현 내용**:
  - ProviderScope 설정
  - 기본 화면 라우팅 (메인, 게임, 결과, 설정)
  - 앱 테마 설정
- **완료 기준**: 기본 화면 전환 동작
- **검증 결과**: ✅ HomeScreen, CameraScreen, SettingsScreen 네비게이션 확인
- **소요 시간**: 45분

### ✅ T1.3: 권한 처리 기본 구조 [완료]

- **목표**: permission_handler 설정
- **구현 내용**:
  - 카메라 권한 요청 서비스 생성
  - 저장소 권한 요청 서비스 생성
  - 권한 상태 관리
- **완료 기준**: 권한 요청 기본 플로우 동작
- **검증 결과**: ✅ PermissionService 구현, 권한 다이얼로그 동작
- **소요 시간**: 30분

## 📷 Phase 2A: 카메라 기초 (1일)

### ✅ T2A.1: 카메라 미리보기 화면 구현 [완료]

- **목표**: 기본 카메라 UI 생성
- **구현 내용**: CameraPreview 위젯 구현
- **완료 기준**: 카메라 미리보기 정상 표시
- **검증 결과**: ✅ CameraService, CameraProvider, CameraScreen 구현, 비율 문제 해결
- **소요 시간**: 1시간

### ✅ T2A.2: 프론트 카메라 스트림 활성화 [완료]

- **목표**: 전면 카메라 영상 스트림 획득
- **구현 내용**:
  - 전면 카메라 초기화
  - 카메라 스트림 관리
- **완료 기준**: 전면 카메라 영상 스트림 획득
- **검증 결과**: ✅ 이미지 스트림 기능 구현, 상태 표시 UI 완료
- **소요 시간**: 30분

### ✅ T2A.3: 카메라 권한 처리 [완료]

- **목표**: 카메라 권한 통합 처리
- **구현 내용**:
  - 권한 요청 플로우
  - 권한 거부 시 안내 UI
- **완료 기준**: 권한 거부/승인 시나리오 모두 처리
- **검증 결과**: ✅ HomeScreen, CameraScreen 권한 통합, 에러 UI 개선
- **소요 시간**: 30분

## 🤖 Phase 2B: ML Kit 기초 (1일)

### ✅ T2B.1: google_mlkit_face_detection 기본 설정 [완료]

- **목표**: ML Kit 라이브러리 초기화
- **구현 내용**:
  - FaceDetector 초기화
  - ML Kit 옵션 설정 (FAST 모드, Contours ON)
- **완료 기준**: FaceDetector 객체 생성 성공
- **검증 결과**: ✅ FaceDetectionService 구현, CameraScreen 통합, 상태 표시 UI
- **소요 시간**: 45분

### ✅ T2B.2: 기본 얼굴 감지 (bounding box만)

- **목표**: 얼굴 영역 박스 감지
- **구현 내용**:
  - 카메라 스트림을 InputImage로 변환
  - FaceDetector로 얼굴 감지
  - bounding box 좌표 추출
- **완료 기준**: 얼굴 영역 박스 화면 표시
- **검증 결과**: ✅ FaceDetectionOverlay 구현, CustomPainter 좌표 변환, 실시간 bounding box 표시
- **소요 시간**: 45분

### T2B.3: 얼굴 감지 성능 검증

- **목표**: 성능 요구사항 달성
- **구현 내용**:
  - FPS 모니터링
  - 지연 시간 측정
- **완료 기준**: 30fps 이상 유지, 지연 <100ms
- **테스트 방법**: 성능 오버레이로 실시간 측정

## 🎯 Phase 2C: ML Kit 고급 - 입술 추적 (2일)

### T2C.1: 얼굴 랜드마크 추출

- **목표**: 전체 얼굴 랜드마크 획득
- **구현 내용**:
  - FaceDetectorOptions에 랜드마크 활성화
  - 모든 랜드마크 포인트 추출
- **완료 기준**: 전체 얼굴 랜드마크 좌표 획득
- **테스트 방법**: 랜드마크 포인트들을 화면에 점으로 표시

### T2C.2: 입술 특정 랜드마크 추출

- **목표**: 입술 관련 랜드마크만 추출
- **구현 내용**:
  - upperLipTop, lowerLipBottom 포인트 추출
  - 입술 중심점 계산
- **완료 기준**: 입술 포인트 화면에 표시
- **테스트 방법**: 입술 위아래에 빨간 점 표시

### T2C.3: 입술 거리 계산 로직

- **목표**: 입술 간 거리 실시간 계산
- **구현 내용**:
  - 유클리드 거리 계산 함수
  - 정규화 로직 (얼굴 크기 대비)
- **완료 기준**: 실시간 입술 간 거리 수치 표시
- **테스트 방법**: 입 벌림 정도에 따른 수치 변화 확인

### T2C.4: 입 열림/닫힘 상태 판정

- **목표**: threshold 기반 상태 분류
- **구현 내용**:
  - 동적 threshold 계산
  - 상태 enum 정의 (OPEN, CLOSED)
  - 상태 변화 감지
- **완료 기준**: 열림/닫힘 상태 실시간 표시
- **테스트 방법**: 입 벌림/닫힘에 따른 상태 텍스트 변화

### T2C.5: 상태 변화 감지 (열림→닫힘 이벤트)

- **목표**: 게임 트리거 이벤트 생성
- **구현 내용**:
  - 상태 변화 히스토리 관리
  - 열림→닫힘 전환 감지
  - 이벤트 발생 시 입술 위치 저장
- **완료 기준**: 입 닫는 순간 이벤트 발생 로그
- **테스트 방법**: 콘솔 로그로 이벤트 발생 확인

## 🎮 Phase 3: 게임 로직 구현 (2-3일)

### T3.1: Flame 엔진 기본 설정

- **목표**: 게임 엔진 초기화
- **구현 내용**: GameWidget, FlameGame 기본 구조
- **완료 기준**: 빈 게임 화면 렌더링

### T3.2: 풍선 스프라이트 컴포넌트 생성

- **목표**: 풍선 게임 오브젝트 생성
- **구현 내용**: SpriteComponent 상속한 Balloon 클래스
- **완료 기준**: 풍선 스프라이트 화면 표시

### T3.3: 풍선 10개 랜덤 배치 로직

- **목표**: 게임 시작 시 풍선 배치
- **구현 내용**: 랜덤 위치 생성, 겹침 방지
- **완료 기준**: 풍선 10개가 겹치지 않게 배치

### T3.4: 게임 타이머 (15초) 구현

- **목표**: 게임 시간 제한
- **구현 내용**: Timer 컴포넌트, UI 표시
- **완료 기준**: 15초 카운트다운 정상 동작

### T3.5: 점수 시스템 구현

- **목표**: 풍선 터뜨릴 때마다 점수 증가
- **구현 내용**: 점수 상태 관리, UI 업데이트
- **완료 기준**: 점수 증가 및 표시 정상 동작

### T3.6: 입 위치와 풍선 거리 계산

- **목표**: 입 위치 기준 가장 가까운 풍선 찾기
- **구현 내용**: 거리 계산 알고리즘, 좌표계 변환
- **완료 기준**: 입 위치에서 가장 가까운 풍선 식별

### T3.7: 풍선 터뜨리기 로직 (가장 가까운 풍선)

- **목표**: 입 닫힘 이벤트로 풍선 제거
- **구현 내용**: 이벤트 연동, 풍선 제거, 점수 증가
- **완료 기준**: 입 닫을 때 가장 가까운 풍선 터짐

### T3.8: 애니메이션 및 사운드 효과

- **목표**: 풍선 터지는 효과
- **구현 내용**: 터지는 애니메이션, 사운드 재생
- **완료 기준**: 풍선 터질 때 시각/청각 피드백

## 🎨 Phase 4: UI/UX 구현 (1일)

### T4.1: 메인 화면 UI

- **목표**: 게임 시작 화면
- **구현 내용**: 시작 버튼, 로고, 카메라 미리보기
- **완료 기준**: 3-tap 내 게임 시작 가능

### T4.2: 게임 중 UI (점수, 타이머)

- **목표**: 게임 플레이 중 정보 표시
- **구현 내용**: 점수, 남은 시간, 남은 풍선 수
- **완료 기준**: 실시간 정보 업데이트

### T4.3: 게임 결과 화면 UI

- **목표**: 게임 종료 후 결과 표시
- **구현 내용**: 최종 점수, 축하/격려 메시지, 이모지
- **완료 기준**: 결과에 따른 적절한 피드백

### T4.4: 설정 화면 (감도 조절, 사운드)

- **목표**: 사용자 설정 조정
- **구현 내용**: 슬라이더, 토글 버튼, 설정 저장
- **완료 기준**: 설정 변경 및 저장 동작

## 📹 Phase 5: 녹화 및 공유 기능 (2일)

### T5.1: screen_recorder 설정

- **목표**: 화면 녹화 라이브러리 초기화
- **구현 내용**: 녹화 권한, 녹화 옵션 설정
- **완료 기준**: 녹화 기능 정상 동작

### T5.2: 게임과 연동한 녹화 제어

- **목표**: 게임 시작/종료와 자동 연동
- **구현 내용**: 게임 상태와 녹화 상태 동기화
- **완료 기준**: 게임 플레이 15초 자동 녹화

### T5.3: 녹화 영상 임시 저장 및 미리보기

- **목표**: 녹화 완료 후 영상 재생
- **구현 내용**: 임시 파일 관리, 비디오 플레이어
- **완료 기준**: 게임 플레이 영상 자동 재생

### T5.4: 저장/공유/건너뛰기 UI 구현

- **목표**: 사용자 선택 옵션 제공
- **구현 내용**: 3개 버튼 UI, 선택에 따른 분기
- **완료 기준**: 각 옵션 선택 시 적절한 동작

### T5.5: 저장소 권한 및 갤러리 저장

- **목표**: 사용자 선택 시 영상 저장
- **구현 내용**: 저장소 권한 요청, 갤러리 저장
- **완료 기준**: 영상 갤러리 저장 및 성공 알림

### T5.6: SNS 공유 기능 (share_plus)

- **목표**: 소셜 미디어 직접 공유
- **구현 내용**: share_plus 연동, 앱 선택 UI
- **완료 기준**: 틱톡, 인스타그램 등으로 공유 가능

## 🔄 작업 프로세스

1. 각 태스크 시작 전 목표 확인
2. 구현 완료 후 테스트 실행
3. **완료 기준 달성 시 사용자에게 확인 요청**
4. 승인 후 다음 태스크 진행
5. 문제 발생 시 즉시 보고 및 대응 방안 논의

## ⚠️ 주요 위험 요소

- **ML Kit 성능**: 디바이스별 얼굴 인식 속도 차이
- **메모리 사용량**: 카메라+ML Kit+게임+녹화 동시 실행
- **디바이스 호환성**: 다양한 Android 기기 대응

## 📊 성능 목표

- 얼굴 인식 지연: ≤ 100ms
- 메모리 사용량: ≤ 300MB (피크, 녹화 포함)
- FPS: ≥ 30fps (게임 중), 60fps (녹화)
- 앱 실행 시간: < 3초 (콜드 스타트)

## 🎯 완료 기준

- 세션 완료율: ≥ 70% (게임 시작 → 결과까지)
- 평균 세션 길이: ≥ 30초 (1회 게임 플레이)
- 크래시율: < 1%

**예상 총 개발 기간: 7-10일** (각 태스크 확인 시간 포함)

---

## 📝 진행 상황 추적

### ✅ 완료된 태스크

- **T1.1**: Flutter 프로젝트 초기 설정 [2025-08-06 완료]
- **T1.2**: 기본 앱 구조 설정 [2025-08-06 완료]
- **T1.3**: 권한 처리 기본 구조 [2025-08-06 완료]
- **T2A.1**: 카메라 미리보기 화면 구현 [2025-08-06 완료]
- **T2A.2**: 프론트 카메라 스트림 활성화 [2025-08-06 완료]
- **T2A.3**: 카메라 권한 처리 [2025-08-06 완료]

### 🔄 현재 진행 중

- Phase 2B: ML Kit 기초 구현 (다음 단계)

### 📋 다음 예정

- **T2B.1**: google_mlkit_face_detection 기본 설정
- Phase 2B/2C: ML Kit 얼굴 인식 구현 (가장 복잡한 단계)
